<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Dynamic Attachment Analysis & Sandboxing</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Dynamic Attachment Analysis & Sandboxing</h1><br/><p>------------------------------------------------------------</p><p>Dynamic Attachment Analysis &amp; Sandboxing – Notes</p><p>------------------------------------------------------------</p><p></p><p>Dynamic analysis is the process of executing a suspicious file in a **controlled, isolated environment** to observe what it does. This contrasts with static analysis, where the file is inspected without execution. The key is that behavior tells you intent: how the attachment interacts with the operating system, network, and user environment.</p><p></p><p>------------------------------------------------------------</p><p>Why Dynamic Analysis?</p><p>------------------------------------------------------------<ul><li>Static indicators can be obfuscated or encrypted, making analysis inconclusive.</li><li>Malware often reveals itself only when executed (e.g., downloading payloads, creating persistence).</li><li>Provides concrete IOCs (Indicators of Compromise) from real-world behavior.</li><li>Allows analysts to see tactics, techniques, and procedures (TTPs) used by attackers.</li></ul></p><p></p><p>------------------------------------------------------------</p><p>The Sandboxing Concept</p><p>------------------------------------------------------------<ul><li>A **sandbox** is a virtualized or containerized environment where files are safely executed.</li><li>Sandboxes monitor and log system, process, and network activity.</li><li>They are designed to mimic a real user environment but restrict the malware from escaping.</li><li>Commonly used sandbox platforms: Cuckoo Sandbox, Any.Run, Joe Sandbox, Hybrid Analysis, FireEye, and in-house enterprise solutions.</li></ul></p><p></p><p>------------------------------------------------------------</p><p>Steps in Dynamic Attachment Analysis</p><p>------------------------------------------------------------<ol><li>**Prepare the environment**<ul><li>Isolated VM or sandbox with no production network access.</li><li>Snapshot capability to revert the machine after execution.</li><li>Monitoring tools installed (procmon, Wireshark, Sysmon, etc.).</li></ul></li></ol></p><p><ol><li>**Execute the attachment**<ul><li>Run the file as a user would (double-click or open in the intended application).</li><li>Trigger macros/scripts if that’s the attacker’s pathway (carefully controlled).</li></ul></li></ol></p><p><ol><li>**Observe system behavior**<ul><li>Processes created or modified.</li><li>Registry keys written or altered (persistence mechanisms).</li><li>New files dropped onto the file system.</li><li>Services or scheduled tasks created.</li></ul></li></ol></p><p><ol><li>**Observe network behavior**<ul><li>Outbound connections (domains/IPs contacted).</li><li>Protocols used (HTTP, HTTPS, DNS, SMB, etc.).</li><li>Data exfiltration attempts or C2 (command-and-control) traffic.</li></ul></li></ol></p><p><ol><li>**Collect artifacts and logs**<ul><li>Memory dumps.</li><li>Network captures.</li><li>Sandbox reports (JSON, HTML).</li><li>Dropped files and registry snapshots.</li></ul></li></ol></p><p></p><p>------------------------------------------------------------</p><p>Key Things to Look For</p><p>------------------------------------------------------------<ul><li>**Persistence:** Autorun registry entries, scheduled tasks, startup folder changes.</li><li>**Privilege escalation:** Attempts to exploit local services or elevate to admin.</li><li>**Evasion:** Sandbox detection, sleeping for long periods, checking VM artifacts.</li><li>**Payload delivery:** Downloading second-stage malware, extracting hidden executables.</li><li>**Data theft:** Attempts to access browser caches, clipboard data, or keystrokes.</li></ul></p><p></p><p>------------------------------------------------------------</p><p>Advantages of Sandboxing</p><p>------------------------------------------------------------<ul><li>Safe environment for executing suspicious attachments.</li><li>Produces rich reports quickly with minimal manual intervention.</li><li>Can be automated in email security gateways to detonate attachments before delivery.</li><li>Enables faster incident response by revealing IOCs without deep reverse engineering.</li></ul></p><p></p><p>------------------------------------------------------------</p><p>Limitations and Evasion</p><p>------------------------------------------------------------<ul><li>Malware may detect sandbox artifacts (e.g., certain processes, registry keys, or hardware configurations).</li><li>Some samples require user interaction (clicks, form entries) to fully detonate.</li><li>Time bombs: malware waits hours or days to activate.</li><li>Encrypted or password-protected attachments may bypass automated sandboxing.</li></ul></p><p></p><p>------------------------------------------------------------</p><p>Example Case Narrative</p><p>------------------------------------------------------------</p><p>An employee reports a suspicious Excel file attachment `invoice.xlsm`.  <ol><li>The file is detonated in the sandbox.  </li><li>Upon enabling macros, the sandbox logs show PowerShell launching with a Base64-encoded string.  </li><li>The process tree reveals the PowerShell script contacts `hxxp://malicious-site[.]com/update.exe` and downloads an executable.  </li><li>The downloaded payload attempts persistence by creating a scheduled task named “WindowsUpdateCheck.”  </li><li>The sandbox provides a report with the file hash of the dropped executable, the malicious domain, and the registry modifications.  </li></ol></p><p></p><p>From this, the SOC team extracts IoCs, updates endpoint security, and blocks the domain at the proxy/firewall level.</p><p></p><p>------------------------------------------------------------</p><p>Memory Hook</p><p>------------------------------------------------------------</p><p>Think: **Run → Watch → Record → Extract.**<ul><li>Run (detonate the file in sandbox)</li><li>Watch (observe system/network changes)</li><li>Record (collect logs, dumps, artifacts)</li><li>Extract (IOCs for wider defense)</p><p></li></ul></p></div>
</body>
</html>
